(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{106:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return d}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=r.a.createContext({}),b=function(e){var t=r.a.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},s=function(e){var t=b(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,o=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),s=b(a),m=n,d=s["".concat(o,".").concat(m)]||s[m]||u[m]||i;return a?r.a.createElement(d,l(l({ref:t},p),{},{components:a})):r.a.createElement(d,l({ref:t},p))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:n,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"},99:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return l})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return p})),a.d(t,"default",(function(){return s}));var n=a(2),r=a(6),i=(a(0),a(106)),o=["components"],l={title:"Deploying File Drop on AWS",sidebar_label:"Deploying File Drop on AWS"},c={unversionedId:"products/filedrop/fd-aws",id:"products/filedrop/fd-aws",isDocsHomePage:!1,title:"Deploying File Drop on AWS",description:"Installation video",source:"@site/docs/products/filedrop/fd-aws.md",slug:"/products/filedrop/fd-aws",permalink:"/k8-proxy-documentation/docs/products/filedrop/fd-aws",version:"current",sidebar_label:"Deploying File Drop on AWS",sidebar:"docs",previous:{title:"Troubleshooting",permalink:"/k8-proxy-documentation/docs/products/compliant kubernetes/troubleshooting"},next:{title:"Deploying File Drop on ESXi",permalink:"/k8-proxy-documentation/docs/products/filedrop/fd-esxi"}},p=[{value:"Installation video",id:"installation-video",children:[]},{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Setup AWS access",id:"setup-aws-access",children:[]},{value:"Importing File Drop OVA",id:"importing-file-drop-ova",children:[]},{value:"Deploying File Drop AMI",id:"deploying-file-drop-ami",children:[]},{value:"Remove Internet Access From FileDrop (Optional)",id:"remove-internet-access-from-filedrop-optional",children:[]},{value:"Troubleshooting",id:"troubleshooting",children:[]}],b={rightToc:p};function s(e){var t=e.components,a=Object(r.a)(e,o);return Object(i.b)("wrapper",Object(n.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"installation-video"},"Installation video"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Installation Video (OVA)")),Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=yaBPLn9ISSg&feature=youtu.be"},Object(i.b)("img",{parentName:"a",src:"https://img.youtube.com/vi/yaBPLn9ISSg/hqdefault.jpg",alt:"Installation Video (OVA)"}))),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Installation Video (AMI)")),Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"http://www.youtube.com/watch?v=XvU87KX_Cbc"},Object(i.b)("img",{parentName:"a",src:"https://img.youtube.com/vi/XvU87KX_Cbc/hqdefault.jpg",alt:"Installation Video (AMI)"}))),Object(i.b)("h2",{id:"prerequisites"},"Prerequisites"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"File Drop AMI ID "),Object(i.b)("li",{parentName:"ul"},"File Drop OVA S3 URL")),Object(i.b)("h2",{id:"setup-aws-access"},"Setup AWS access"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Install ",Object(i.b)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html"},"AWS CLI")," on your local machine"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"AWS CLI installation ",Object(i.b)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html"},"Linux"),":"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre"},'curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"\nunzip awscliv2.zip\nsudo ./aws/install\n'))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"AWS CLI installation ",Object(i.b)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-windows.html"},"WIN"),":"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre"},"- Download and install msi: https://awscli.amazonaws.com/AWSCLIV2.msi\n- To verify AWS CLI was installed succesufully open CMD and run: aws --version\n- Result should be like: aws-cli/2.1.1 Python/3.7.4 Windows/10 botocore/2.0.0\n"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"AWS CLI installation ",Object(i.b)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-mac.html"},"MAC"),":"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre"},"- Download latest macOS pkg file: https://awscli.amazonaws.com/AWSCLIV2.pkg\n- Double-click the downloaded file to launch the installer & follow instructions\n- To verify installation, open terminal and run\n - `which aws` output would be   `/usr/local/bin/aws` \n - `aws --version` output would be `aws-cli/2.1.29 Python/3.7.4 Darwin/18.7.0 botocore/2.0.0`\n\n"))))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html"},"Setup AWS Console access")),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"From CMD run: ",Object(i.b)("inlineCode",{parentName:"li"},"aws configure"),". "),Object(i.b)("li",{parentName:"ul"},"Enter the data for values as they pop up.",Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre"},"example:\n    AWS Access Key ID [None]: AKIAIOSFODNN7EXAMPLE\n    AWS Secret Access Key [None]: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\n    Default region name [None]: eu-west-1\n    Default output format [None]: json\n"))))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"If your have MFA token enabled for authentication to AWS account you should ",Object(i.b)("a",{parentName:"p",href:"https://aws.amazon.com/premiumsupport/knowledge-center/authenticate-mfa-cli/"},"set up MFA token authenticate through AWS CLI")),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Run: ",Object(i.b)("inlineCode",{parentName:"li"},"aws sts get-session-token --serial-number arn-of-the-mfa-device --token-code code-from-token")),Object(i.b)("li",{parentName:"ul"},"Replace arn-of-the-mfa-device with your username and AWS number and enter MFA code as code-from-token "),Object(i.b)("li",{parentName:"ul"},"Then export keys",Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre"},"export AWS_ACCESS_KEY_ID=<Value>\nexport AWS_SECRET_ACCESS_KEY=<Value>\nexport AWS_SESSION_TOKEN= <Value>\n"))))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"In case of any permission issues, check if proper Service Role is created as instructed ",Object(i.b)("a",{parentName:"p",href:"https://docs.aws.amazon.com/vm-import/latest/userguide/vmie_prereqs.html#vmimport-role"},"here")," and that all needed permissions are set for user performing the steps. "))),Object(i.b)("h2",{id:"importing-file-drop-ova"},"Importing File Drop OVA"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Download FileDrop OVA from provided S3 URL")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Upload downloaded OVA file to Amazon S3"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Sign in to the AWS Console and open the ",Object(i.b)("a",{parentName:"li",href:"https://console.aws.amazon.com/s3/"},"Amazon S3 console")),Object(i.b)("li",{parentName:"ul"},"In the Buckets list, choose the name of the bucket that you want to upload OVA to or create new bucket"),Object(i.b)("li",{parentName:"ul"},"Choose ",Object(i.b)("inlineCode",{parentName:"li"},"Upload")),Object(i.b)("li",{parentName:"ul"},"On the Upload page, choose ",Object(i.b)("inlineCode",{parentName:"li"},"Add files")),Object(i.b)("li",{parentName:"ul"},"Choose OVA file to upload, and then choose Open"),Object(i.b)("li",{parentName:"ul"},"Once OVA is uploaded, copy OVA S3 URL"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Use AWS CLI to import the image based on provided OVA")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Create containers.json file as per example:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre"},'[\n  {\n    "Description": "My Server OVA",\n    "Format": "ova",\n    "UserBucket": {\n        "S3Bucket": "my-import-bucket", \n        "S3Key": "vms/my-server-vm.ova" \n    }\n}]\n'))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"From your AWS CLI run "),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre"},'aws ec2 import-image --description "My server VM" --disk-containers "file://C:\\import\\containers.json"\n'))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Monitor image import by running: "),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre"},"aws ec2 describe-import-image-tasks --import-task-ids import-ami-ID\n"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"This process can take few minutes, so run above command multiple times until you get, ",Object(i.b)("inlineCode",{parentName:"p"},'"Status": "completed"')," and use AMI ID you got to follow up the steps in next section"))),Object(i.b)("h2",{id:"deploying-file-drop-ami"},"Deploying File Drop AMI"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Navigate to AWS > AMIs"),Object(i.b)("li",{parentName:"ul"},"Search for the AMI with specific ID (make sure you are in correct region)"),Object(i.b)("li",{parentName:"ul"},"Instance can be launch from AMIs or EC2 space",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"From AMIs workspace click on specific AMI > Choose ",Object(i.b)("inlineCode",{parentName:"li"},"Launch")," "),Object(i.b)("li",{parentName:"ul"},"Set instance type to ",Object(i.b)("inlineCode",{parentName:"li"},"t2.large")," (2CPUs and 8GB RAM)"),Object(i.b)("li",{parentName:"ul"},"Skip configuring Instance details and adding the storage (that can be left default if not specified differently)"),Object(i.b)("li",{parentName:"ul"},"Add any tags if needed"),Object(i.b)("li",{parentName:"ul"},"Security Group: ",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Create a new security group > Add Rule:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"HTTP > Port 80 "),Object(i.b)("li",{parentName:"ul"},"HTTPS > Port 443 "),Object(i.b)("li",{parentName:"ul"},"SSH > Port 22"))))),Object(i.b)("li",{parentName:"ul"},"Click on ",Object(i.b)("inlineCode",{parentName:"li"},"Review and Launch")),Object(i.b)("li",{parentName:"ul"},"Select ",Object(i.b)("inlineCode",{parentName:"li"},"Create or use existing key pair")," ","[Note: Your key pair is important for SSH]"),Object(i.b)("li",{parentName:"ul"},"Wait for instance to be initialized (~10 minutes) and use public IP to access File Drop web interface")))),Object(i.b)("h2",{id:"remove-internet-access-from-filedrop-optional"},"Remove Internet Access From FileDrop (Optional)"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"EC2 > Navigate to your instance > Under your Instance Summary > Security\n",Object(i.b)("img",{parentName:"li",src:"https://user-images.githubusercontent.com/60857664/108712705-d735df00-751f-11eb-9bdb-388cbf43a687.png",alt:"security-tab"})),Object(i.b)("li",{parentName:"ul"},"Security Details > Security Groups > Click on ",Object(i.b)("inlineCode",{parentName:"li"},"sg-...")," (your launch-wizard)"),Object(i.b)("li",{parentName:"ul"},"Outbound rules tab > Edit outbound rules > Delete the outbound rule & save rules\n",Object(i.b)("img",{parentName:"li",src:"https://user-images.githubusercontent.com/60857664/108713672-36e0ba00-7521-11eb-93d1-e10246562216.png",alt:"Screenshot from 2021-02-22 15-18-03"}))),Object(i.b)("h2",{id:"troubleshooting"},"Troubleshooting"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"If the UI does not load, run ",Object(i.b)("inlineCode",{parentName:"li"},"kubectl get pod -A")," to check the status of pods"),Object(i.b)("li",{parentName:"ul"},"If their status is not ",Object(i.b)("inlineCode",{parentName:"li"},"ready"),", in home directory run ",Object(i.b)("inlineCode",{parentName:"li"},"./flush_iptables.sh")),Object(i.b)("li",{parentName:"ul"},"Then run ",Object(i.b)("inlineCode",{parentName:"li"},"sudo systemctl restart k3s")),Object(i.b)("li",{parentName:"ul"},"Give it ~3 minutes, and then navigate to ",Object(i.b)("inlineCode",{parentName:"li"},"http://<VM IP>"))))}s.isMDXComponent=!0}}]);